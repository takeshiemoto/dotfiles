# Claude Code 開発ガイドライン

## 基本設定

ここに書かれている内容はすべて強い制約です。必ず守ること。

### 言語設定

- 全てのコミュニケーションは日本語で行う
- 過度な丁寧語は避け、カジュアルな言葉遣いを使用する

## コーディング基本方針

### ナレッジベース

以下の文献に基づいた設計・実装を行う：

- **マーチン・ファウラーのリファクタリングカタログ**: コード改善の際はリファクタリングパターンを適用
- **マイケル・C・フェザーズのレガシーコード改善ガイド**: 既存コードの改修時は安全な変更手法を採用
- **ロバート・C・マーチンのクリーンアーキテクチャ**: 依存関係の方向性と層構造を意識した設計

## コーディング規約

### 全体共通

- 変数名、関数名などの命名は深く考えること
- 意図が明確に伝わる名前を選択する

### TypeScript

#### 基本原則

- **関数型プログラミングのエッセンスを取り入れる**: 純粋関数、不変性、高階関数を活用
- **クラスは原則として書かない**: 関数とオブジェクトリテラルで実装

#### 具体的なルール

- `null` を利用せず `undefined` を利用する
- `let` は使用せず、`const` を利用する
- `else` は極力使用せず、条件分岐は早期リターンで抜ける
- イミュータブルなデータ操作を心がける（配列やオブジェクトの破壊的変更を避ける）

#### 型安全性の強化

- **anyの使用禁止**: `any`は原則使用禁止。やむを得ず使う場合はTODOコメントを残し、後続タスクで必ず除去する
- **unknownの活用**: 動的データは`unknown`で受け取り、型ガードやスキーマバリデーションで安全に絞り込む
- **Null安全の徹底**: `strictNullChecks`を前提とし、Optional Chaining（`?.`）とNull合体演算子（`??`）で安全に扱う
- **非null断言の回避**: 非null断言演算子`!`の多用は避け、明示的なガードを挟む

#### 型の絞り込みとガード

- **型ガードの実装**: `function isFoo(x: unknown): x is Foo`形式のユーザー定義型ガードを推奨
- **ランタイム検証**: 外部入力はZod等でランタイム検証し、型と実データを同期させる
- **リテラル型の活用**: 状態や種別は`"draft" | "published"`等のリテラルUnionで表現し、魔法文字列を排除
- **判別可能Union**: `kind`プロパティを判別子としたDiscriminated Unionで安全なパターンマッチを実現

#### 高度な型機能

- **網羅性チェック**: switch文の末尾で`assertUnreachable(value)`を呼び、未処理ケースをコンパイル時に検出
- **ジェネリクス制約**: 型パラメータには`extends`制約を付与し、過度な汎用化を防ぐ
- **デフォルト型パラメータ**: `<T = Default>`で呼び出し側の型指定を簡略化しつつ安全性を維持

#### interface vs type

- **interfaceの使用**: 公開APIや拡張が想定される型定義には`interface`を使用（宣言合体・拡張性に優れる）
- **typeの使用**: 実装内部や複雑な合成型、Union型、条件型には`type`を使用（表現力が高い）

#### ユーティリティ型の活用

- **標準ユーティリティ優先**: `Partial`・`Required`・`Pick`・`Omit`・`Record`等の標準ユーティリティを優先使用
- **カスタムユーティリティの検討**: カスタムユーティリティ型を追加する前に、既存ユーティリティでの代替を検討

### React

- `useEffect` を利用する前に、必ずドキュメントを確認して利用方法が適切かを検証する
- `default export` は使用せず、`named export` を利用する
- 関連する `useState` や `useEffect` は積極的にカスタム Hook にまとめる

## Gitルール

### コミットメッセージ

`<type>: <description>`

- `feat`: 新機能
- `fix`: バグ修正
- `refactor`: リファクタリング
- `docs`: ドキュメント更新
- `chore`: その他

## Pull Request作成ルール

- 必ず最初は Draft で作成すること
- 必ずプロジェクトの PullRequest テンプレートを参照し利用すること（ `/.github/PULL_REQUEST_TEMPLATE.md` ）
- 該当しない項目は空欄にせず明示的に `N/A` を入力すること

## コードレビュー基準

### 可読性・保守性

- **命名規則と一貫性**: 変数・関数・ファイル名がドメインを正確に表現し、プロジェクトの命名規則に従っているか確認する
- **コード量と複雑度**: 関数は単一責務の原則に従い短く保つ。不要なネストや重複を排除する
- **コメントと型情報**: 自明でない意図は適切にコメント・JSDoc・TypeScript型で補足する。型安全性を常に保証する

### アーキテクチャ設計

- **関心の分離**: UI層・データ取得層・状態管理層・ビジネスロジック層を明確に分離する
- **再利用性と拡張性**: 共通コンポーネントやカスタムフックを適切に抽象化し、将来の機能追加に備えた構造にする

### パフォーマンス

- **ネットワーク最適化**: 遅延読み込み（コード分割）・キャッシュ制御・画像最適化を適切に実装する
- **計算量とレンダリング効率**: 不要な再レンダリングを防ぎ、O(n²)以上の計算量となる処理を避ける

### 信頼性

- **エラーハンドリング**: 例外処理を網羅的に実装し、ユーザーと開発者の両方に分かりやすいエラー情報を提供する

### ドキュメント・コミュニケーション

- **PR説明**: 変更の目的・背景・具体的な変更点・検証手順を明確に記述し、レビュアーが全体像を把握できるようにする

### React特有の観点

#### コンポーネント設計・責務

- **単一責任の徹底**: 1コンポーネント1責務を厳守。UI表示・データ取得・状態管理・ビジネスロジックを混在させない
- **責務の明確化**: コンポーネントが「表示専用」「状態管理」「データ取得」のいずれかを明確にする
- **条件分岐は親で実行**: 子コンポーネント内での条件分岐は最小限に留め、表示制御は親コンポーネントで行う
- **巨大コンポーネントの分割**: 50行を超えるコンポーネントは責務ごとに分割を検討する
- **フォルダ構成**: 機能単位でディレクトリを構成し、componentsディレクトリの肥大化を防ぐ

#### コンポーネント純粋性・再利用性

- **純粋性の保持**: 同じPropsに対して常に同じ結果を返す。副作用は最小限に抑制する
- **Props依存の徹底**: コンポーネント内で外部状態に直接アクセスしない。必要なデータはすべてProps経由で受け取る
- **再利用可能性の確保**: 特定のページや機能に依存しない汎用的な設計にする
- **カスタムフックへの抽出**: 状態ロジックやAPIコールは積極的にカスタムフックに切り出す
- **重複UIの統合**: 類似UIは共通コンポーネント化し、variantsやテーマで差異を表現する

#### 命名・インターフェース一貫性

- **命名の統一**: コンポーネント名はPascalCase、Props名はcamelCaseを厳守
- **ドメイン用語の統一**: プロジェクト全体で同一概念には同一用語を使用（User vs Member など）
- **Props命名の一貫性**: 同様の機能を持つPropsは統一した命名規則を採用（onSubmit、onSave、onUpdateなど）
- **boolean Propsの命名**: `is*`、`has*`、`can*`、`should*`のプレフィックスを使用
- **コールバック Props**: `on*`プレフィックスで統一（onClick、onChange、onSubmitなど）

#### Props・State管理

- **型安全な定義**: interfaceでProps・Stateを明示的に定義する。暗黙的なanyを排除する
- **表現力の高いProps**: 真偽値の乱用を避け、列挙型や判別型ユニオンで意図を明確にする
- **不要なState排除**: UIから導出できる値は計算で求める。過剰なuseStateを持たない

#### フックの利用

- **useEffectループ防止**: 依存配列を正しく設定し、副作用を最小化する
- **カスタムフック**: 重複処理をuseSomethingで抽象化し、テスタビリティを向上させる

#### セキュリティ

- **XSS対策**: Reactの自動エスケープに加え、外部HTMLはDOMPurify等でサニタイズする
- **機密情報の秘匿**: APIキーや秘密情報をクライアントバンドルに含めない

#### エラーハンドリング・ロギング

- **Error Boundary**: アプリケーション境界に配置し、クラッシュを防ぎつつUIフォールバックを提供する
- **監視ツール連携**: 例外情報を適切にログ出力する。開発・本番でログレベルを切り替える

### レビュー結果の出力

- **レビュー依頼対応時**: コードレビュー結果をマークダウンファイルとしてデスクトップに出力する
- **ファイル名フォーマット**: `<タイムスタンプ>_<リポジトリ名>_PR<PR番号>.md`
  - タイムスタンプ形式: `YYYYMMDD_HHMMSS`
  - 例: `20240315_143052_myapp_PR123.md`